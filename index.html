<!DOCTYPE html>
<html>

	<head>
		<title>3D Visualize Lidar Robot</title>
		<style>
			body {
				margin: 0;
			}

			#loader {
				position: fixed;
				background-color: rgba(0, 0, 0, 0.5);
				top: 0px;
				bottom: 0px;
				right: 0px;
				left: 0px;
				z-index: 999;
			}

			#loader> div {
				font-size: 24px;
				color: white;
				position: fixed;
				left: 50%;
				top: 30%;
				margin-left: -5%;
			}
		</style>
	</head>

	<body>
		<div id="loader">
			<div>
				Loading ...<span id='progressinfo'></span>
			</div>
		</div>
		<div class="viewport"></div>
		<script src="./javascripts/three.min.js"></script>
		<script src="./javascripts/OrbitControls.js"></script>
		<script>
			var container, scene, renderer, camera, light, loader, controls;
			var WIDTH, HEIGHT, VIEW_ANGLE, ASPECT, NEAR, FAR;
			var PI = 3.142;

			container = document.querySelector('.viewport');


			WIDTH = window.innerWidth,
				HEIGHT = window.innerHeight - 6;

			VIEW_ANGLE = 45,
				ASPECT = WIDTH / HEIGHT,
				NEAR = 1,
				FAR = 10000;

			scene = new THREE.Scene();

			renderer = new THREE.WebGLRenderer({
				antialias: true
			});

			renderer.setSize(WIDTH, HEIGHT);
			renderer.shadowMap.enabled = true;
			renderer.shadowMap.soft = true;
			renderer.shadowMap.type = THREE.PCFShadowMap;
			renderer.shadowMapAutoUpdate = true;

			container.appendChild(renderer.domElement);

			camera = new THREE.PerspectiveCamera(VIEW_ANGLE, ASPECT, NEAR, FAR);

			camera.position.set(20, 100, 1000);
			camera.rotation.x = -Math.PI / 12;

			scene.add(camera);
			/*
						light = new THREE.DirectionalLight(0xffffff);

						light.position.set(0, 100, 60);
						light.castShadow = true;
						light.shadow.camera.left = -60;
						light.shadow.camera.top = -60;
						light.shadow.camera.right = 60;
						light.shadow.camera.bottom = 60;
						light.shadow.camera.near = 1;
						light.shadow.camera.far = 3000;
						light.shadow.bias = -.0001
						light.shadow.mapSize.width = light.shadow.mapSize.height = 1024;

						scene.add(light);*/
			controls = new THREE.OrbitControls(camera, renderer.domElement);

			scene.fog = new THREE.Fog(0xf7d9aa, 100, 950);

			//	scene.add(new THREE.AmbientLight(0x444444));

			window.addEventListener('resize', function() {
				WIDTH = window.innerWidth,
					HEIGHT = window.innerHeight - 6;

				renderer.setSize(WIDTH, HEIGHT);
				camera.aspect = WIDTH / HEIGHT;
				camera.updateProjectionMatrix();
			});

			renderer.setClearColor(0x333F47, 1);

			loader = new THREE.ObjectLoader();

			loader.load('models/json/meshes.json', function(_scene) {
				document.querySelector("#loader").style.display = "none";
				var directionalLight1 = _scene.getObjectByName("DirectionalLight1");

				var motor_1 = _scene.getObjectByName("motor_1");
				var motor_2 = _scene.getObjectByName("motor_2");
				var motor_3 = _scene.getObjectByName("motor_3");
				var motor_4 = _scene.getObjectByName("motor_4");

				var motor_shaft = _scene.getObjectByName("motor_shaft");
				//	var wheel = _scene.getObjectByName("wheel");
				var base = _scene.getObjectByName("base");
				var c_clamp_1 = _scene.getObjectByName("c_clamp_1");
				var c_clamp_2 = _scene.getObjectByName("c_clamp_2");
				var c_clamp_3 = _scene.getObjectByName("c_clamp_3");
				var c_clamp_4 = _scene.getObjectByName("c_clamp_4");

				var top_plate = _scene.getObjectByName("top_plate");
				var circuit_plate = _scene.getObjectByName("circuit_plate");
				var feedback = _scene.getObjectByName("feedback");
				var lidar_base = _scene.getObjectByName("lidar_base");

				var lidar_bottom = _scene.getObjectByName("lidar_bottom");
				var lidar_up = _scene.getObjectByName("lidar_up");
				var stud = _scene.getObjectByName("stud");

				scene.add(directionalLight1);

				base.rotation.x = 0;
				scene.add(base);

				motor_1.rotation.y = -PI / 2;
				motor_1.position.x = 297;
				motor_1.position.y = 41;
				scene.add(motor_1);

				motor_2.rotation.x = PI;
				motor_2.position.z = 297;
				motor_2.position.y = 41;
				scene.add(motor_2);

				motor_3.rotation.y = PI / 2;
				motor_3.position.x = -297;
				motor_3.position.y = 41;
				scene.add(motor_3);

				motor_4.rotation.x = 0;
				motor_4.position.z = -297;
				motor_4.position.y = 41;
				scene.add(motor_4);


				c_clamp_1.rotation.x = 0;
				c_clamp_1.position.x = 255;
				c_clamp_1.position.y = 41;
				scene.add(c_clamp_1);

				c_clamp_2.rotation.x = 0;
				c_clamp_2.rotation.y = -PI / 2;
				c_clamp_2.position.z = 255;
				c_clamp_2.position.y = 41;
				scene.add(c_clamp_2);

				c_clamp_3.rotation.x = 0;
				c_clamp_3.rotation.y = PI;
				c_clamp_3.position.x = -255;
				c_clamp_3.position.y = 41;
				scene.add(c_clamp_3);

				c_clamp_4.rotation.x = 0;
				c_clamp_4.rotation.y = PI / 2;
				c_clamp_4.position.z = -255;
				c_clamp_4.position.y = 41;
				scene.add(c_clamp_4);


				top_plate.rotation.x = 0;
				top_plate.position.y = 82.4;
				scene.add(top_plate);

				render();
			}, function(d) {
				if (d.type == "progress" && d.lengthComputable) {
					var tot = parseInt(d.loaded / d.total * 1000);
					tot /= 10;
					document.querySelector("#progressinfo").innerHTML = (tot + "%");
				}
			});

			function render() {
				controls.update();
				renderer.render(scene, camera);
				requestAnimationFrame(render);
			}
		</script>
	</body>

</html>
