<!DOCTYPE html>
<html>

   <head>
      <title>Lidar Robot GUI</title>
      <meta charset="utf-8" />
      <link href="./webserver/css/nouislider.min.css" rel="stylesheet">

      <script src="./webserver/js/three.min.js"></script>
      <script src="./webserver/js/ColladaLoader2.min.js"></script>
      <script src="./webserver/js/STLLoader.min.js"></script>
      <script src="./webserver/js/eventemitter2.min.js"></script>
      <script src="./webserver/js/roslib.min.js"></script>
      <script src="./webserver/js/ros3d.min.js"></script>
      <script src="./webserver/js/jointstatepublisher.min.js"></script>
      <script src="./webserver/js/keyboardteleop.min.js"></script>
      <script src="./webserver/js/jquery-3.0.0.min.js"></script>
      <script src="./webserver/js/nouislider.min.js"></script>
      <style>
               body {
            padding: 0px;
            margin: 0px;
            overflow: hidden;
           }

           #sliders {
              background-color: rgba(255, 255, 255, 0.7);
              padding: 10px;
              right: 20px;
              top: 20px;
              position: absolute;
             }

             #sliders * {
                position: relative!important;
               }
      </style>
      <script>
         function init() {
            var ros = new ROSLIB.Ros();
            // If there is an error on the backend, an 'error' emit will be emitted.
            ros.on('error', function(error) {
               document.getElementById('connecting').style.display = 'none';
               document.getElementById('connected').style.display = 'none';
               document.getElementById('closed').style.display = 'none';
               document.getElementById('error').style.display = 'inline';
               console.log(error);
            });
            // Find out exactly when we made a connection.
            ros.on('connection', function() {
               console.log('Connection made!');
               document.getElementById('connecting').style.display = 'none';
               document.getElementById('error').style.display = 'none';
               document.getElementById('closed').style.display = 'none';
               document.getElementById('connected').style.display = 'inline';
            });
            ros.on('close', function() {
               console.log('Connection closed.');
               document.getElementById('connecting').style.display = 'none';
               document.getElementById('connected').style.display = 'none';
               document.getElementById('closed').style.display = 'inline';
            });

            ros.connect('ws://127.0.0.1:9090');

            // Initialize the teleop.
            var teleop = new KEYBOARDTELEOP.Teleop({
               ros: ros,
               topic: '/cmd_vel'
            });

            var viewer = new ROS3D.Viewer({
               divID: 'urdf',
               width: window.innerWidth,
               height: window.innerHeight,
               antialias: true,
               background: '#002233'
            });

            viewer.addObject(new ROS3D.Grid({
               color: '#0181c4',
               cellSize: 1,
               num_cells: 100
            }));

            var tfClient = new ROSLIB.TFClient({
               ros: ros,
               angularThres: 0.01,
               transThres: 0.01,
               rate: 10.0,
               fixedFrame: '/map'
            });

            var u = new ROS3D.UrdfClient({
               ros: ros,
               tfClient: tfClient,
               path: './src/',
               rootObject: viewer.scene,
               loader: ROS3D.COLLADA_LOADER_2
            });

            var speed = document.getElementById('speed');
            noUiSlider.create(speed, {
               start: 90, // Handle start position
               range: { // Slider can select '0' to '100'
                  'min': 0,
                  'max': 100
               }
            });
            speed.noUiSlider.on('update', function(values, handle) {
               values[0]
               document.getElementById('speedInfo').innerHTML = values[0];
               teleop.scale = (values[0] / 100.0);
            });
         }
      </script>
   </head>

   <body onload="init()">
      <div id="sliders">
         <div id="statusIndicator">
            <p id="connecting">
               Connecting to rosbridge...
            </p>
            <p id="connected" style="color:#00D600; display:none">
               Connected
            </p>
            <p id="error" style="color:#FF0000; display:none">
               Error in the backend!
            </p>
            <p id="closed" style="display:none">
               Connection closed.
            </p>
         </div>
         <label for="speed">
            Robot Speed: <b><span id="speedInfo">90</span>%</b>
            <br>
            <span id="speed"></span>
         </label>
      </div>
      <div id="urdf"></div>
   </body>

</html>
